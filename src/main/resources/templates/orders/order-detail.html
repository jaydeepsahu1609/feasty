<!--
  ~ Copyright 2026 Jaydeep Sahu
  ~ Practice / learning project
-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: common-head('Order #' + ${order.orderId})}">
</head>

<body>
<div class="container">

    <div class="app-header">
        <h2>Order #<span th:text="${order.orderId}"></span></h2>

        <div>
            <a href="/ui/orders/open" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back
            </a>

            <a th:href="@{/ui/orders/{id}/items(id=${order.orderId})}"
               class="btn btn-outline-primary ms-2">
                <i class="bi bi-plus-circle"></i> Add Items
            </a>
        </div>
    </div>

    <div class="card p-3 mb-4">
        <p>
            <b>Table:</b>
            <span th:text="${order.tableId != null ? order.tableId : 'TAKEAWAY'}"></span>
        </p>
        <p>
            <b>Status:</b>
            <span class="badge badge-open" th:text="${order.status}"></span>
        </p>
    </div>

    <!-- ===== TOTAL CALCULATION (SAFE) ===== -->
    <table class="table">
        <thead>
        <tr>
            <th>Item</th>
            <th>Qty Served</th>
            <th>Pending</th>
            <th>Price</th>
            <th>Total</th>
            <th></th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="oi : ${order.orderItems}">
            <td>
                <b th:text="${oi.item.name}"></b><br/>
                <small class="text-muted" th:text="${oi.item.description}"></small>
            </td>

            <td id="${order.orderId}-count" th:text="${oi.itemsCount}"></td>
            <td th:text="${oi.pendingItems}"></td>

            <td>
                ₹ <span th:text="${#numbers.formatDecimal(oi.item.cost, 1, 2)}"></span>
            </td>

            <td>
                ₹ <span
                    th:text="${#numbers.formatDecimal((oi.itemsCount + oi.pendingItems) * oi.item.cost, 1, 2)}"></span>
            </td>

            <td>
                <button class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-plus"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger">
                    <i class="bi bi-dash"></i>
                </button>
            </td>
        </tr>

        <tr class="fw-bold table-light">
            <td colspan="4" class="text-end">
                Total Amount:
            </td>
            <td>
                ₹ <span th:text="${order.getTotal()}">0.00</span>
            </td>
            <td></td>
        </tr>

        <tr class="fw-bold table-light">
            <td colspan="4" class="text-end">
                CGST (2.5%):
            </td>
            <td>
                ₹ <span th:text="${order.getTotal() * 0.025}">0.00</span>
            </td>
            <td></td>
        </tr>

        <tr class="fw-bold table-light">
            <td colspan="4" class="text-end">
                SGST (2.5%):
            </td>
            <td>
                ₹ <span th:text="${order.getTotal() * 0.025}">0.00</span>
            </td>
            <td></td>
        </tr>

        <tr class="fw-bold table-light">
            <td colspan="4" class="text-end">
                Total Amount:
            </td>
            <td>
                ₹ <span th:text="${order.getTotal() + (order.getTotal() * 0.05)}">0.00</span>
            </td>
            <td></td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>
